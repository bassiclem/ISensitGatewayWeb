<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>fit20 | Registration Page</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Bootstrap 3.3.6 -->
    <link rel="stylesheet" href="../../bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="css/ionicons.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="../../dist/css/AdminLTE.min.css">
    <!-- iCheck -->
    <link rel="stylesheet" href="../../plugins/iCheck/square/blue.css">
    <link rel="stylesheet" href="css/isensitGW.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body class="hold-transition ">
<div class="pad margin no-print">
    <div class="callout callout-info" style="margin-bottom: 0!important;">
        <h4><i class="fa fa-info"></i> Note:</h4>
        Various data sets are still in development
    </div>
</div>

<section class="content">
    <div class="row">
        <div class="col-md-6">
            <!-- AREA CHART -->
            <div class="box box-primary hidden">
                <div class="box-header with-border">
                    <h3 class="box-title">Area Chart</h3>

                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                        </button>
                        <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                    </div>
                </div>
                <div class="box-body">
                    <div class="chart">
                        <canvas id="areaChart" style="height: 250px; width: 787px;" height="250" width="787"></canvas>
                    </div>
                </div>
                <!-- /.box-body -->
            </div>
            <!-- /.box -->



        </div>
        <!-- /.col (LEFT) -->
        <div class="col-md-12">
            <!-- LINE CHART -->
            <div class="box box-info">
                <div class="box-header with-border">
                    <h3 class="box-title">Overview</h3>

                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                        </button>
                        <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                    </div>
                </div>
                <div class="box-body">
                    <div class="chart">
                        <canvas id="lineChart" style="height: 250px; width: 787px;" height="250" width="787"></canvas>
                    </div>
                </div>
                <!-- /.box-body -->
            </div>
            <!-- /.box -->


        </div>
        <!-- /.col (RIGHT) -->
    </div>
    <!-- /.row -->

</section>


<div class="row">

    <!-- /.col -->
    <div class="col-md-6 col-sm-6 col-xs-12">
        <div class="info-box">
            <span class="info-box-icon bg-yellow"><i class="fa fa-clock-o"></i></span>

            <div class="info-box-content">
                <span class="info-box-text">Time</span>
                <span class="info-box-number">2 min</span>
            </div>
            <!-- /.info-box-content -->
        </div>
        <!-- /.info-box -->
    </div>
    <!-- /.col -->
    <div class="col-md-6 col-sm-6 col-xs-12">
        <div class="info-box">
            <span class="info-box-icon bg-red"><i class="fa fa-star-o"></i></span>

            <div class="info-box-content">
                <span class="info-box-text">Quality Score</span>
                <span class="info-box-number">6.2</span>
                <a href="#" class="btn btn-flat btn-default">previous scores</a>
            </div>
            <!-- /.info-box-content -->
        </div>
        <!-- /.info-box -->
    </div>
    <!-- /.col -->
</div>
<!-- /.row -->

<!-- =========================================================== -->

<div class="row">
    <div class="col-md-6 col-sm-6 col-xs-12">
        <div class="info-box bg-aqua">
            <span class="info-box-icon"><i class="fa fa-bookmark-o"></i></span>

            <div class="info-box-content">
                <span class="info-box-text">Session Number</span>
                <span class="info-box-number">5</span>

                <div class="progress">
                    <div class="progress-bar" style="width: 70%"></div>
                </div>
                <span class="progress-description">
                    70% Increase in 30 Days
                  </span>
            </div>
            <!-- /.info-box-content -->
        </div>
        <!-- /.info-box -->
    </div>
    <!-- /.col -->
    <div class="col-md-6 col-sm-6 col-xs-12">
        <div class="info-box bg-green">
            <span class="info-box-icon"><i class="fa fa-user"></i></span>

            <div class="info-box-content">
                <span class="info-box-text">User</span>
                <span class="info-box-number">Elizabeth</span>

                <div class="progress">
                    <div class="progress-bar" style="width: 70%"></div>
                </div>
                <span class="progress-description">
                    70% Increase in 30 Days
                  </span>
            </div>
            <!-- /.info-box-content -->
        </div>
        <!-- /.info-box -->
    </div>
    <!-- /.col -->
    <!-- /.col -->
    <!-- /.col -->
</div>
<!-- /.row -->

<!-- =========================================================== -->

<!-- Small boxes (Stat box) -->
<div class="row">
    <!-- ./col -->
    <div class="col-lg-6 col-xs-6">
        <!-- small box -->
        <div class="small-box bg-green">
            <div class="inner">
                <h3>53<sup style="font-size: 20px">%</sup></h3>

                <p>Improvement</p>
            </div>
            <div class="icon">
                <i class="ion ion-stats-bars"></i>
            </div>
            <a href="#" class="small-box-footer">
                More info <i class="fa fa-arrow-circle-right"></i>
            </a>
        </div>
    </div>
    <!-- ./col -->
    <div class="col-lg-6 col-xs-6">
        <!-- small box -->
        <div class="small-box bg-yellow">
            <div class="inner">
                <h3>Trainer</h3>

                <p>Test</p>
            </div>
            <div class="icon">
                <i class="ion ion-person-add"></i>
            </div>
            <a href="#" class="small-box-footer">
                More info <i class="fa fa-arrow-circle-right"></i>
            </a>
        </div>
    </div>
    <div class="clearfix"></div>
    <!-- ./col -->
    <!-- ./col -->
<div class="row  ">
    <!--<a id="continueBtn" href="training.html" class="btn  bg-olive  btn-flat btn-block">Continue Session</a>-->
    <a id="resultsDoneBtn" class="btn  btn-flat bg-maroon btn-block" style="height: 50px; font-size: 30px;">Done</a>
</div>
</div>

<div id="sessionPage"></div>


<!-- /.row -->

<!-- =========================================================== -->


<!-- jQuery 2.2.3 -->

<script src="../../plugins/jQuery/jquery-2.2.3.min.js"></script>
<!-- Bootstrap 3.3.6 -->
<script src="../../bootstrap/js/bootstrap.min.js"></script>
<!-- ChartJS 1.0.1 -->
<script src="../../plugins/chartjs/Chart.min.js"></script>
<!-- FastClick -->
<script src="../../plugins/fastclick/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="../../dist/js/app.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="../../dist/js/demo.js"></script>
<!--<li>-->
<!--<img alt="User Image" src="../../dist/img/equipmentLow Back.png">-->
<!--<a href="#" class="users-list-name">Low Back</a>-->
<!--<span class="users-list-date">14 Jan</span>-->
<!--</li>-->
<script>
    var apiUrl = window.location.origin + ':8001';
    var apiHost = apiUrl + '/api/fit20/1.0/';
    console.log(apiHost);
    var devices;
    var users;

    //
    //    $(function getDeviceData() {
    //        $.getJSON(apiHost + 'machinesData', function (data) {
    //            devices = data;
    //            var machineList=[];
    //
    //
    //            $.each(devices, function (item) {
    //                $('#machineChoices').append('<li id="'+ devices[item].id +'"></li>');
    //                var extra_status, machineStatus;
    //                if (devices[item].status =='paired'){
    //                    console.log('Pair was found');
    //                    machineStatus = 'Online';
    //                    extra_status='btn-success disabled';
    //                    $('#'+devices[item].id).css('border', '5px solid rgb(120, 222, 49)');
    //                }
    //                else{
    //                    machineStatus = 'Offline';
    //                    extra_status='btn-danger';
    //                }
    //
    //                $('#'+devices[item].id).prepend('<img alt="'+ devices[item].longName +'" src="'+  devices[item].photoURI +'" />')
    //                        .append('<p>'+ devices[item].name +'</p>')
    //                        .append('<a href="#" class="btn btn-warning">Edit</a>&nbsp;<span style="" class="btn '+ extra_status +' ">'+ machineStatus +'</span>');
    //
    //
    //
    //
    //            });
    ////            $.each(data, function (key, value) {
    ////                console.log(value);
    ////            });
    //        });
    //    });
    //
    //

    var user_rep_data =[];
    var user_ref_data =[];
    var user_value_data =[];
    function getUserData() {
        $.getJSON(apiHost + 'userdata/'+machineName, function (data) {
            $.each(data[1], function (key) {
                user_rep_data.push(data[1][key][2]);
                user_ref_data.push(data[1][key][0]);
                user_value_data.push(data[1][key][1]);
            });
            makeChart();
        });
    }

    $(function () {
        getUserData();
    });



    function generateMachineList() {
        getDeviceData();
        console.log(devices);
    }


    function makeChart () {
        /* ChartJS
         * -------
         * Here we will create a few charts using ChartJS
         */

        //--------------
        //- AREA CHART -
        //--------------

        // Get context with jQuery - using jQuery's .get() method.
        var areaChartCanvas = $("#areaChart").get(0).getContext("2d");
        // This will get the first returned node in the jQuery collection.
        var areaChart = new Chart(areaChartCanvas);

        console.log(user_ref_data);
        labels= ["1", "2", "3", "4", "5", "6", "7", "8","9","10"]
        console.log(labels);
        var areaChartData = {
//            labels: ["1", "2", "3", "4", "5", "6", "7", "8","9","10"],
            labels: user_rep_data,
            datasets: [
                {
                    label: "Reference",
                    fillColor: "rgba(210, 214, 222, 1)",
                    strokeColor: "rgba(210, 214, 222, 1)",
                    pointColor: "rgba(210, 214, 222, 1)",
                    pointStrokeColor: "#c1c7d1",
                    pointHighlightFill: "#fff",
                    pointHighlightStroke: "rgba(220,220,220,1)",
                    data:user_ref_data
                },
                {
                    label: "Member",
                    fillColor: "rgba(60,141,188,0.9)",
                    strokeColor: "rgba(60,141,188,0.8)",
                    pointColor: "#3b8bba",
                    pointStrokeColor: "rgba(60,141,188,1)",
                    pointHighlightFill: "#fff",
                    pointHighlightStroke: "rgba(60,141,188,1)",
//                    data: [0, 48, 40, 19, 86, 27, 60, 45, 44, 80]
                    data: user_value_data
                }
            ]
        };

        var areaChartOptions = {
            //Boolean - If we should show the scale at all
            showScale: true,
            //Boolean - Whether grid lines are shown across the chart
            scaleShowGridLines: false,
            //String - Colour of the grid lines
            scaleGridLineColor: "rgba(0,0,0,.05)",
            //Number - Width of the grid lines
            scaleGridLineWidth: 1,
            //Boolean - Whether to show horizontal lines (except X axis)
            scaleShowHorizontalLines: true,
            //Boolean - Whether to show vertical lines (except Y axis)
            scaleShowVerticalLines: true,
            //Boolean - Whether the line is curved between points
            bezierCurve: true,
            //Number - Tension of the bezier curve between points
            bezierCurveTension: 0.3,
            //Boolean - Whether to show a dot for each point
            pointDot: false,
            //Number - Radius of each point dot in pixels
            pointDotRadius: 3,
            //Number - Pixel width of point dot stroke
            pointDotStrokeWidth: 1,
            //Number - amount extra to add to the radius to cater for hit detection outside the drawn point
            pointHitDetectionRadius: 20,
            //Boolean - Whether to show a stroke for datasets
            datasetStroke: true,
            //Number - Pixel width of dataset stroke
            datasetStrokeWidth: 3,
            //Boolean - Whether to fill the dataset with a color
            datasetFill: true,
            //String - A legend template
            legendTemplate: "<ul class=\"<%=name.toLowerCase()%>-legend\"><% for (var i=0; i<datasets.length; i++){%><li><span style=\"background-color:<%=datasets[i].lineColor%>\"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>",
            //Boolean - whether to maintain the starting aspect ratio or not when responsive, if set to false, will take up entire container
            maintainAspectRatio: true,
            //Boolean - whether to make the chart responsive to window resizing
            responsive: true
        };

        //Create the line chart
        areaChart.Line(areaChartData, areaChartOptions);

        //-------------
        //- LINE CHART -
        //--------------
        var lineChartCanvas = $("#lineChart").get(0).getContext("2d");
        var lineChart = new Chart(lineChartCanvas);
        var lineChartOptions = areaChartOptions;
        lineChartOptions.datasetFill = false;
        lineChart.Line(areaChartData, lineChartOptions);



    };

    var apiUrl = window.location.origin + ':8001';
    var apiHost = apiUrl + '/api/fit20/1.0/';
    console.log(apiHost);
    var devices;
    var users;
    var multiplicationFactorUserBar = 3.6;
    var userDegree = 0;
    var referenceDegree = 0;
    var session_status = 'idle';
    function setProgrees(){
        console.log("difference:" , referenceDegree - userDegree);
        if( (referenceDegree - userDegree) >= 30 || (referenceDegree - userDegree) <= -30){
            $('#user-progress').attr('class', "progress-bar progress-bar-red");
        }
        else if( referenceDegree - userDegree >= 10 || (referenceDegree - userDegree) <= -10){
            $('#user-progress').attr('class', "progress-bar progress-bar-yellow");
        }
        else{
            $('#user-progress').attr('class',"progress-bar progress-bar-green");
        }
    }

    setProgrees();
    $('#calibrateBtn').click(function () {
        if (userDegree != 0) {
            multiplicationFactorUserBar = 100/userDegree
        }
    });
    //
    //    $(function getDeviceData() {
    //        $.getJSON(apiHost + 'machinesData', function (data) {
    //            devices = data;
    //            var machineList=[];
    //
    //
    //            $.each(devices, function (item) {
    //                $('#machineChoices').append('<li id="'+ devices[item].id +'"></li>');
    //                var extra_status, machineStatus;
    //                if (devices[item].status =='paired'){
    //                    console.log('Pair was found');
    //                    machineStatus = 'Online';
    //                    extra_status='btn-success disabled';
    //                    $('#'+devices[item].id).css('border', '5px solid rgb(120, 222, 49)');
    //                }
    //                else{
    //                    machineStatus = 'Offline';
    //                    extra_status='btn-danger';
    //                }
    //
    //                $('#'+devices[item].id).prepend('<img alt="'+ devices[item].longName +'" src="'+  devices[item].photoURI +'" />')
    //                        .append('<p>'+ devices[item].name +'</p>')
    //                        .append('<a href="#" class="btn btn-warning">Edit</a>&nbsp;<span style="" class="btn '+ extra_status +' ">'+ machineStatus +'</span>');
    //
    //
    //
    //
    //            });
    ////            $.each(data, function (key, value) {
    ////                console.log(value);
    ////            });
    //        });
    //    });
    //
    //


    var getUrlParameter = function getUrlParameter(sParam) {
        console.log('getting params');
        var sPageURL = decodeURIComponent(window.location.search.substring(1)),
                sURLVariables = sPageURL.split('&'),
                sParameterName,
                i;

        for (i = 0; i < sURLVariables.length; i++) {
            sParameterName = sURLVariables[i].split('=');

            if (sParameterName[0] === sParam) {
                return sParameterName[1] === undefined ? true : sParameterName[1];
            }
        }
    };

    var machineName = getUrlParameter('machine');
    $('#machineName').html(machineName);

    function session_action(action) {
        $.post(apiHost + "sessionmanager",
                {
                    action: action,
                    machine: machineName
                },
                function (data, status) {
                    if (data[0].status =="error"){
//                        $('#sessionErrorAlert').html( '<button type="button" class="close" data-dismiss="alert" aria-hidden="true">Ã—</button>' + "Error: " +  data[1].message);
//                        $('#sessionErrorAlert').show()
                    }
                });
    }

    function completeSession() {
       session_action('complete');
        session_status = 'complete';
        $('#sessionPage').delay(3000).queue(function( nxt ) {
            window.open(window.location.origin+'/demo/admin/dashboard/pages/training.html', '_self');
            if (win) {
                //Browser has allowed it to be opened
                win.focus();
            } else {
                //Browser has blocked it
                alert('Please allow popups for this website');
            }
            nxt();
        });
        }

    function continueSession() {
        session_action('complete');
        $('#sessionPage').delay(3000).queue(function( nxt ) {
            window.open(window.location.origin+'/demo/admin/dashboard/pages/training.html', '_self');
            if (win) {
                //Browser has allowed it to be opened
                win.focus();
            } else {
                //Browser has blocked it
                alert('Please allow popups for this website');
            }
            nxt();
        });
        }

    $("#resultsDoneBtn").click(function () {
        console.log("completed");
        completeSession();
    });
     $("#continueBtn").click(function () {
            console.log("completed");
            continueSession();
        });


    var progressVal = 0;
    var presentUrl = window.location.hostname;
    var rootUrl = presentUrl[2];
    var apiUrl = window.location.origin + ':8001/api/fit20/1.0/';
    console.log(apiUrl);
    var count = 0;
    var newLiftPercent = 0;

    function setProgress(progressBarID, newProgress) {
        console.log("Progress bar setter ", newProgress);
        var currentProgress = parseInt(document.getElementById(progressBarID).style.width);
        if (currentProgress < 0)
            currentProgress = 0;
        if (newProgress > 100)
            newProgress = 100;
        if ((newProgress - currentProgress) && (newProgress <= 100)) {
            $('#'+progressBarID+'-number').html(newProgress + '%');
//            document.getElementById(progressBarID).html = (newProgress) + '%';
            document.getElementById(progressBarID).style.width = (newProgress) + '%';
            //  }
        }
        //$("#user-progress").style.width(progressVal);
    }

    var liveData = {};
    count=0;

    function loadLiftData() {
        console.log("request URI :", apiHost + "sessionmanager/"+machineName );
        $.getJSON(apiHost + "sessionmanager/"+machineName ,
                function (data) {
                    count += 1;
                    var msg = '';

                    $.each(data, function (key, value) {
                        liveData = data;
                        msg += key + ' : ' + value + '\n';
                    });
                    final = "Count: " + count.toString() + ' ' + msg;
                    $("#demo").html(final).toString();
                    referenceDegree = parseInt(liveData[0].Values.referenceValue).toFixed(0);
                    userDegree = parseInt( liveData[0].Values.memberValue).toFixed(0);
                    $('#repCounter').html(liveData[0].Values.CurrentRep);
                    if (liveData[0].Values.State=='DONE'){
                        stopSession();
                        referenceDegree = 0;
                        userDegree = 0;
                    }
                    console.log("degree: ", referenceDegree );
                    setProgress('target-progress', (referenceDegree));
                    setProgress('user-progress', (userDegree));
                    setProgrees();
                });
        if(session_status=='play'){
            setTimeout("loadLiftData()", 80);
        }
    }


</script>



</body>
</html>
